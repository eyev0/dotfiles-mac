# set -g default-terminal "screen-256color-kitty"
# set -g default-terminal "tmux-256color-kitty"
# set -g default-terminal "screen-256color"
# set -g default-terminal "tmux"
# set -g default-terminal "kitty"
# set -g default-terminal "xterm-256color"
# set -g default-terminal "tmux-256color"
# set -g default-terminal "xterm-kitty"
# set -g default-terminal "screen"

set -g default-terminal "${TERM}"
# set -g default-terminal "tmux-256color"

# set -sa terminal-overrides ',xterm-kitty:RGB'
# set -ga terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[ q' # cursor

# set -as terminal-features ',XXX:RGB'
# set -ag terminal-overrides ",xterm-256color:RGB"
# TEST
# set -as terminal-features ",xterm*:RGB"

# set -gs terminal-overrides ',*:RGB'
# set -as terminal-features ',*:Smulx=\E[4::%p1%dm'  # undercurl support
# set -as terminal-features ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # underscore colours - needs tmux-3.0
# set -as terminal-features ',*:sitm=\E[3m,*:ritm=\E[23m'

# f keys
# set -sa terminal-features ',*:kBEG=\E[1;2E,*:kDC=\E[3;2~,*:kEND=\E[1;2F,*:kHOM=\E[1;2H,*:kIC=\E[2;2~,*:kLFT=\E[1;2D,*:kNXT=\E[6;2~,*:kPRV=\E[5;2~,*:kRIT=\E[1;2C,*:ka1=,*:ka3=,*:kbeg=\EOE,*:kbs=\177,*:kc1=,*:kc3=,*:kcbt=\E[Z,*:kcub1=\EOD,*:kcud1=\EOB,*:kcuf1=\EOC,*:kcuu1=\EOA,*:kdch1=\E[3~,*:kend=\EOF,*:kf1=\EOP,*:kf10=\E[21~,*:kf11=\E[23~,*:kf12=\E[24~,*:kf13=\E[1;2P,*:kf14=\E[1;2Q,*:kf15=\E[13;2~,*:kf16=\E[1;2S,*:kf17=\E[15;2~,*:kf18=\E[17;2~,*:kf19=\E[18;2~,*:kf2=\EOQ,*:kf20=\E[19;2~,*:kf21=\E[20;2~,*:kf22=\E[21;2~,*:kf23=\E[23;2~,*:kf24=\E[24;2~,*:kf25=\E[1;5P,*:kf26=\E[1;5Q,*:kf27=\E[13;5~,*:kf28=\E[1;5S,*:kf29=\E[15;5~,*:kf3=\EOR,*:kf30=\E[17;5~,*:kf31=\E[18;5~,*:kf32=\E[19;5~,*:kf33=\E[20;5~,*:kf34=\E[21;5~,*:kf35=\E[23;5~,*:kf36=\E[24;5~,*:kf37=\E[1;6P,*:kf38=\E[1;6Q,*:kf39=\E[13;6~,*:kf4=\EOS,*:kf40=\E[1;6S,*:kf41=\E[15;6~,*:kf42=\E[17;6~,*:kf43=\E[18;6~,*:kf44=\E[19;6~,*:kf45=\E[20;6~,*:kf46=\E[21;6~,*:kf47=\E[23;6~,*:kf48=\E[24;6~,*:kf49=\E[1;3P,*:kf5=\E[15~,*:kf50=\E[1;3Q,*:kf51=\E[13;3~,*:kf52=\E[1;3S,*:kf53=\E[15;3~,*:kf54=\E[17;3~,*:kf55=\E[18;3~,*:kf56=\E[19;3~,*:kf57=\E[20;3~,*:kf58=\E[21;3~,*:kf59=\E[23;3~,*:kf6=\E[17~,*:kf60=\E[24;3~,*:kf61=\E[1;4P,*:kf62=\E[1;4Q,*:kf63=\E[13;4~,*:kf7=\E[18~,*:kf8=\E[19~,*:kf9=\E[20~,*:khlp=,*:khome=\EOH,*:kich1=\E[2~,*:kind=\E[1;2B,*:kmous=\E[M,*:knp=\E[6~,*:kpp=\E[5~,*:kri=\E[1;2A,*:kund='


# non-login shell
# set -g default-command "${SHELL} -i"
# set-option -g default-command "Tmux > /dev/null 2>&1; ${SHELL}"

# login shell on mac
set -g default-command "${SHELL}"

setw -g xterm-keys on

set -s escape-time 5                     # faster command sequences
set -sg repeat-time 240                   # increase repeat timeout
set -s focus-events on

set -g prefix C-a
unbind C-a
bind C-a send-prefix

setw -q -g utf8 on

set -g history-limit 10000                 # boost history

set -g mouse on

# -- display -------------------------------------------------------------------

set -g base-index 1           # start windows numbering at 1
setw -g pane-base-index 1     # make pane numbering consistent with windows

setw -g automatic-rename on   # rename window to reflect current program
set -g renumber-windows on    # renumber windows when a window is closed

# set -g set-titles on          # set terminal title
set -g set-titles off

set -g display-panes-time 800 # slightly longer pane indicators display time
set -g display-time 800       # slightly longer status messages display time

set -g status-interval 5     # redraw status line every 10 seconds
set -g status-position top

# activity
set -g monitor-activity on
set -g visual-activity off

set -g remain-on-exit off

# -- keybinds -------------------------------------------------------------------

# reload tmux configuration
bind C-e source-file ~/.tmux.conf \; display '~/.tmux.conf sourced'
# pfp
bind k "switch-client -p"
bind j "switch-client -n"
bind l "switch-client -l"
bind x run-shell "pfp kill-session"
# bind C-w choose-tree -Zw
# bind w display-popup -E -w 80% -h 80% "pfp sessions"
bind w choose-tree -Zw
bind C-w display-popup -E -w 80% -h 80% "pfp sessions"
bind s display-popup -E -w 80% -h 80% "pfp start"
bind o display-popup -E -w 80% -h 80% "pfp new-session"
# bind C-o display-popup -E -w 80% -h 80% "pfp new-window"
bind C-o display-popup -E -w 80% -h 80% "pfp new-window"
# zhistory fzf
bind C-r run-shell "cat ~/.zsh_history | sed -E \"s/^: [0-9]+:0;//\" | fzf --tac"
bind i run-shell "tmux neww tmux-cht.sh"

bind C-d clear-history

bind -r D neww -c "#{pane_current_path}" "[[ -e TODO.md ]] && nvim TODO.md || nvim ~/buddy/TODO.md"

# restart nvim
# bind n send-keys :wa \; run "sleep 0.09" \; send-keys C-m \; run "sleep 0.09" \; send-keys C-F12 \; run "sleep 0.09" \; send-keys nvim \; send-keys C-m

#

# new window with cwd
bind C-c new-window -c "#{pane_current_path}"
#

bind C-x "kill-pane"
# create session
bind c "new-session"
# split current window horizontally
bind C-s split-window -v -c "#{pane_current_path}"
# split current window vertically
bind C-v split-window -h -c "#{pane_current_path}"
# hide/restore windows
bind C-M-w "break-pane -d"
bind C-M-s "join-pane -v -s $.1"
bind C-M-v "join-pane -h -s $.1"

bind > "swap-pane -D" # swap current pane with the next one
bind < "swap-pane -U" # swap current pane with the previous one

# bind C-R "respawn-window"

bind -r C-j "previous-window" # select previous window
bind -r C-k "next-window" # select next window
bind -r C-h "swap-window -t -1 ; select-window -t -1"
bind -r C-l "swap-window -t +1 ; select-window -t +1"

bind b list-buffers  # list paste buffers

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
        | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
bind -n 'C-S-Left' if-shell "$is_vim" 'send-keys C-S-Left' 'resize-pane -L 4'
bind -n 'C-S-Down' if-shell "$is_vim" 'send-keys C-S-Down' 'resize-pane -D 4'
bind -n 'C-S-Up' if-shell "$is_vim" 'send-keys C-S-Up' 'resize-pane -U 4'
bind -n 'C-S-Right' if-shell "$is_vim" 'send-keys C-S-Right' 'resize-pane -R 4'

bind -T copy-mode-vi 'C-h' select-pane -L
bind -T copy-mode-vi 'C-j' select-pane -D
bind -T copy-mode-vi 'C-k' select-pane -U
bind -T copy-mode-vi 'C-l' select-pane -R
bind -T copy-mode-vi "C-\\" select-pane -l
bind -T copy-mode-vi 'C-S-Left' resize-pane -L 4
bind -T copy-mode-vi 'C-S-Down' resize-pane -D 4
bind -T copy-mode-vi 'C-S-Up' resize-pane -U 4
bind -T copy-mode-vi 'C-S-Right' resize-pane -R 4

bind-key -n 'C-\' if-shell "$is_vim" 'send-keys C-\\' 'select-pane -l'
#

set -g mode-keys vi
bind a copy-mode
bind C-a copy-mode
run -b 'tmux bind -T copy-mode-vi v send -X begin-selection 2> /dev/null || true'
run -b 'tmux bind -T copy-mode-vi C-v send -X rectangle-toggle 2> /dev/null || true'
run -b 'tmux bind -T copy-mode-vi y send -X copy-selection-and-cancel 2> /dev/null || true'
run -b 'tmux bind -T copy-mode-vi Escape send -X cancel 2> /dev/null || true'
run -b 'tmux bind -T copy-mode-vi H send -X start-of-line 2> /dev/null || true'
run -b 'tmux bind -T copy-mode-vi L send -X end-of-line 2> /dev/null || true'

# List of plugins
set -g @plugin 'tmux-plugins/tpm'

# set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'
# set -g @continuum-restore 'on'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'dracula/tmux'

# resurrect shortcuts
set -g @resurrect-save 'S'
set -g @resurrect-restore 'R'

# dracula
set -g @dracula-ram-usage true
set -g @dracula-cpu-usage true
set -g @dracula-gpu-usage false
# set -g @dracula-synchronize-panes true
# set -g @dracula-git true

set -g @dracula-show-time false
set -g @dracula-show-timezone false
set -g @dracula-day-month false
set -g @dracula-show-fahrenheit false

set -g @dracula-show-powerline true
set -g @dracula-show-left-sep 
set -g @dracula-show-right-sep 

# set -g @dracula-show-left-icon smiley
set -g @dracula-show-left-icon session
set -g @dracula-left-icon-padding 1

set -g @dracula-show-flags true
set -g @dracula-show-location false
set -g @dracula-show-battery true
set -g @dracula-show-network false
set -g @dracula-show-weather false
set -g @dracula-network-bandwidth true

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
